<!DOCTYPE html>
<html>
<head>
  <title>ShapenShot - PNGãƒ•ãƒ¬ãƒ¼ãƒ </title>
  <style>
    .camera-wrapper {
      position: relative;
      width: 100%;
      max-width: 100vw;
      aspect-ratio: 3 / 4;
      margin: 0 auto;
    }

    video, .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .overlay {
      pointer-events: none;
    }

    .frame-buttons {
      margin-top: 10px;
    }

    .frame-buttons button {
      margin-right: 10px;
    }
    @media (max-width: 600px) {
      .frame-buttons button {
        font-size: 1.2rem;
        padding: 10px;
      }
    }
  </style>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-512.png" type="image/png">
  <meta name="theme-color" content="#000000">
</head>
<body>
  <h1>ShapenShot - PNGãƒ•ãƒ¬ãƒ¼ãƒ è¡¨ç¤º</h1>

  <div class="camera-wrapper">
    <video id="video" autoplay playsinline></video>
    <img id="frameImage" class="overlay" src="frames/frame_circle.png" alt="ãƒ•ãƒ¬ãƒ¼ãƒ " />
  </div>

  <div class="frame-buttons">
    <button onclick="setShape('frame_circle')">å††</button>
    <button onclick="setShape('frame_star')">æ˜Ÿ</button>
    <button onclick="setShape('frame_triangle')">ä¸‰è§’</button>
    <!-- æ’®å½±ãƒœã‚¿ãƒ³ -->
    <button onclick="takePhoto()">ðŸ“¸ æ’®å½±</button>
    <!-- æ’®å½±ç”»åƒã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <img id="snapshot" width="300" />
    <!-- è¦‹ãˆãªã„canvas -->
    <canvas id="canvas" width="300" height="300" style="display:none;"></canvas>
  </div>

  <script>
    const video = document.getElementById('video');

    navigator.mediaDevices.getUserMedia({ video: true })
      .then((stream) => {
        video.srcObject = stream;
      })
      .catch((error) => {
        alert("ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸ: " + error);
      });

    function setShape(shape) {
      document.getElementById('frameImage').src = `frames/${shape}.png`;
    }
    function takePhoto() {
  const video = document.getElementById('video');
  const frameImage = document.getElementById('frameImage');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  // ðŸ’¡ videoã®å®Ÿéš›ã®ã‚µã‚¤ã‚ºã‚’å–å¾—
  const videoWidth = video.videoWidth;
  const videoHeight = video.videoHeight;

  // ðŸ’¡ canvasã®ã‚µã‚¤ã‚ºã‚’videoã«åˆã‚ã›ã‚‹
  canvas.width = videoWidth;
  canvas.height = videoHeight;

  // Step 1: Canvasã‚’ã‚¯ãƒªã‚¢
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Step 2: æ˜ åƒã‚’æç”»ï¼ˆvideoã¨åŒã˜æ¯”çŽ‡ï¼‰
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  // Step 3: ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒã‚’åŒã˜ã‚µã‚¤ã‚ºã§é‡ã­ã‚‹
  ctx.drawImage(frameImage, 0, 0, canvas.width, canvas.height);

  // Step 4: ä¿å­˜ãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
  const dataURL = canvas.toDataURL('image/png');
  document.getElementById('snapshot').src = dataURL;

  const a = document.createElement('a');
  a.href = dataURL;
  a.download = 'shapenshot.png';
  a.click();
}
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('serviceWorker.js').then(reg => {
        console.log("Service Worker registered:", reg.scope);
      }).catch(err => {
        console.log("Service Worker registration failed:", err);
      });
    });
  }
  </script>
</body>
</html>